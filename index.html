<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSRS Item Flipping Tracker</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cinzel', serif;
            background: linear-gradient(45deg, #2d1810, #4a2c1a, #2d1810);
            color: #f4e4bc;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #8b4513, #a0522d);
            border: 3px solid #daa520;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(218, 165, 32, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            color: #ffcc00;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .tab-btn {
            background: linear-gradient(145deg, #3d2817, #2d1810);
            color: #f4e4bc;
            border: 2px solid #8b4513;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab-btn:hover, .tab-btn.active {
            background: linear-gradient(145deg, #8b4513, #a0522d);
            color: #ffcc00;
            border-color: #daa520;
            box-shadow: 0 0 10px rgba(218, 165, 32, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(145deg, #3d2817, #2d1810);
            border: 2px solid #8b4513;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #ffcc00;
        }

        .stat-value {
            font-size: 2.2em;
            color: #ffcc00;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #f4e4bc;
            font-size: 1.1em;
        }

        .panel {
            background: linear-gradient(145deg, #3d2817, #2d1810);
            border: 2px solid #8b4513;
            border-radius: 8px;
            padding: 20px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }

        .panel h3 {
            color: #ffcc00;
            margin-bottom: 15px;
            font-size: 1.5em;
            text-align: center;
            border-bottom: 2px solid #8b4513;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #f4e4bc;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #8b4513;
            border-radius: 5px;
            background: linear-gradient(145deg, #2d1810, #1a0f08);
            color: #f4e4bc;
            font-family: 'Cinzel', serif;
            font-size: 14px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #daa520;
            box-shadow: 0 0 10px rgba(218, 165, 32, 0.3);
        }

        .btn {
            background: linear-gradient(145deg, #8b4513, #a0522d);
            color: #ffcc00;
            border: 2px solid #daa520;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Cinzel', serif;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: linear-gradient(145deg, #a0522d, #8b4513);
            box-shadow: 0 0 15px rgba(218, 165, 32, 0.5);
            transform: translateY(-2px);
        }

        .btn-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: linear-gradient(145deg, #3d2817, #2d1810);
            border: 2px solid #8b4513;
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #8b4513;
        }

        th {
            background: linear-gradient(145deg, #8b4513, #a0522d);
            color: #ffcc00;
            font-weight: 700;
        }

        tr:hover {
            background: rgba(218, 165, 32, 0.1);
        }

        .profit-positive {
            color: #00ff00;
            font-weight: bold;
        }

        .profit-negative {
            color: #ff4444;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            color: #ffcc00;
            font-size: 1.2em;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öîÔ∏è OSRS Item Flipping Tracker ‚öîÔ∏è</h1>
            <p>Track your Grand Exchange flips and maximize your profits!</p>
            <div class="nav-tabs">
                <button class="tab-btn active" onclick="showTab('tracker')">üìä Main Tracker</button>
                <button class="tab-btn" onclick="showTab('dashboard')">üìà Dashboard</button>
                <button class="tab-btn" onclick="showTab('history')">üìú History</button>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-value" id="totalProfit">0 gp</div>
                <div class="stat-label">Total Profit</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üî•</div>
                <div class="stat-value" id="activeFlips">0</div>
                <div class="stat-label">Active Flips</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value" id="completedFlips">0</div>
                <div class="stat-label">Completed Flips</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-value" id="avgProfit">0 gp</div>
                <div class="stat-label">Avg Profit per Flip</div>
            </div>
        </div>

        <!-- Main Tracker Tab -->
        <div id="tracker-tab" class="tab-content active">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                <div class="panel">
                    <h3>üõí Add New Flip</h3>
                    <form id="flipForm">
                        <div class="form-group">
                            <label for="itemName">Item Name:</label>
                            <input type="text" id="itemName" name="itemName" required placeholder="e.g., Abyssal whip">
                        </div>
                        
                        <div class="form-group">
                            <label for="buyPrice">Buy Price (ea):</label>
                            <input type="number" id="buyPrice" name="buyPrice" required placeholder="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="quantity">Quantity:</label>
                            <input type="number" id="quantity" name="quantity" required placeholder="1" value="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="sellPrice">Target Sell Price (ea):</label>
                            <input type="number" id="sellPrice" name="sellPrice" placeholder="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="status">Status:</label>
                            <select id="status" name="status">
                                <option value="Active">Active</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn" style="width: 100%;">Add Flip</button>
                    </form>
                </div>

                <div class="panel">
                    <h3>üöÄ Quick Actions</h3>
                    <div class="btn-grid">
                        <button class="btn" onclick="refreshData()">üîÑ Refresh Data</button>
                        <button class="btn" onclick="clearAllFlips()">üóëÔ∏è Clear All Flips</button>
                        <button class="btn" onclick="exportData()">üì§ Export Data</button>
                        <button class="btn" onclick="showProfitAnalysis()">üìà Profit Analysis</button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h3>üìú Your Flips</h3>
                <div class="loading" id="loading">Loading flips...</div>
                <table id="flipsTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Item</th>
                            <th>Buy Price</th>
                            <th>Sell Price</th>
                            <th>Quantity</th>
                            <th>Total Invested</th>
                            <th>Profit</th>
                            <th>ROI</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="flipsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content">
            <div class="panel">
                <h3>üìä Performance Dashboard</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="text-align: center; background: linear-gradient(145deg, #2d1810, #1a0f08); padding: 15px; border-radius: 5px;">
                        <div style="font-size: 1.8em; color: #ffcc00;">23.5%</div>
                        <div style="color: #f4e4bc;">Portfolio ROI</div>
                    </div>
                    <div style="text-align: center; background: linear-gradient(145deg, #2d1810, #1a0f08); padding: 15px; border-radius: 5px;">
                        <div style="font-size: 1.8em; color: #ffcc00;">67.8%</div>
                        <div style="color: #f4e4bc;">Win Rate</div>
                    </div>
                    <div style="text-align: center; background: linear-gradient(145deg, #2d1810, #1a0f08); padding: 15px; border-radius: 5px;">
                        <div style="font-size: 1.8em; color: #ffcc00;">2.3 days</div>
                        <div style="color: #f4e4bc;">Avg Flip Time</div>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="panel">
                    <h3>üèÜ Top Performing Items</h3>
                    <div id="topItemsList">
                        <div style="padding: 10px; margin: 5px 0; background: linear-gradient(145deg, #2d1810, #1a0f08); border-radius: 5px; display: flex; justify-content: space-between;">
                            <span>Abyssal Whip</span>
                            <span style="color: #00ff00;">+2.5M gp</span>
                        </div>
                        <div style="padding: 10px; margin: 5px 0; background: linear-gradient(145deg, #2d1810, #1a0f08); border-radius: 5px; display: flex; justify-content: space-between;">
                            <span>Dragon Claws</span>
                            <span style="color: #00ff00;">+1.8M gp</span>
                        </div>
                        <div style="padding: 10px; margin: 5px 0; background: linear-gradient(145deg, #2d1810, #1a0f08); border-radius: 5px; display: flex; justify-content: space-between;">
                            <span>Bandos Chestplate</span>
                            <span style="color: #00ff00;">+1.5M gp</span>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h3>üì∞ Recent Activity</h3>
                    <div id="recentActivity">
                        <div style="padding: 8px; margin: 5px 0; background: linear-gradient(145deg, #2d1810, #1a0f08); border-radius: 5px;">
                            <div style="font-size: 0.9em; color: #b8a082;">2 hours ago</div>
                            <div>‚úÖ Completed flip: Dragon Claws (+450K)</div>
                        </div>
                        <div style="padding: 8px; margin: 5px 0; background: linear-gradient(145deg, #2d1810, #1a0f08); border-radius: 5px;">
                            <div style="font-size: 0.9em; color: #b8a082;">4 hours ago</div>
                            <div>üöÄ Started flip: Abyssal Whip</div>
                        </div>
                        <div style="padding: 8px; margin: 5px 0; background: linear-gradient(145deg, #2d1810, #1a0f08); border-radius: 5px;">
                            <div style="font-size: 0.9em; color: #b8a082;">Yesterday</div>
                            <div>üéâ Hit 5M profit milestone!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="history-tab" class="tab-content">
            <div class="panel">
                <h3>üìú Complete Flip History</h3>
                <div style="margin-bottom: 15px;">
                    <input type="text" id="searchHistory" placeholder="Search items..." style="width: 300px; display: inline-block; margin-right: 10px;">
                    <button class="btn" onclick="searchHistory()">üîç Search</button>
                    <button class="btn" onclick="exportHistory()">üì§ Export History</button>
                </div>
                <div id="historyContent">
                    <p style="text-align: center; color: #f4e4bc; margin: 50px 0;">History will be loaded here...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let flipsData = [];
        let currentTab = 'tracker';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
            
            // Setup form submission
            document.getElementById('flipForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addFlip();
            });
        });

        // Show tab
        function showTab(tabName) {
            // Update buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + '-tab').classList.add('active');
            
            currentTab = tabName;

            // Load tab-specific content
            if (tabName === 'dashboard') {
                loadDashboard();
            } else if (tabName === 'history') {
                loadHistory();
            }
        }

        // Add new flip
        function addFlip() {
            const form = document.getElementById('flipForm');
            const formData = new FormData(form);
            
            const flipData = {
                itemName: formData.get('itemName'),
                buyPrice: parseInt(formData.get('buyPrice')),
                sellPrice: parseInt(formData.get('sellPrice')) || 0,
                quantity: parseInt(formData.get('quantity')),
                status: formData.get('status'),
                date: new Date().toLocaleDateString()
            };
            
            // Show loading
            showLoading(true);
            
            // Call Google Apps Script function
            google.script.run
                .withSuccessHandler(function(result) {
                    showLoading(false);
                    if (result.success) {
                        form.reset();
                        document.getElementById('quantity').value = '1';
                        refreshData();
                        alert('‚úÖ Flip added successfully!');
                    } else {
                        alert('‚ùå Error: ' + result.error);
                    }
                })
                .withFailureHandler(function(error) {
                    showLoading(false);
                    alert('‚ùå Error adding flip: ' + error.message);
                })
                .addFlip(flipData);
        }

        // Refresh data from sheet
        function refreshData() {
            showLoading(true);
            
            google.script.run
                .withSuccessHandler(function(data) {
                    showLoading(false);
                    flipsData = data;
                    updateTable();
                    updateStats();
                })
                .withFailureHandler(function(error) {
                    showLoading(false);
                    // Load mock data for demo
                    loadMockData();
                })
                .getFlips();
        }

        // Load mock data for demonstration
        function loadMockData() {
            flipsData = [
                {
                    date: '2024-01-15',
                    itemName: 'Abyssal Whip',
                    buyPrice: 8200000,
                    sellPrice: 8650000,
                    quantity: 1,
                    status: 'Completed'
                },
                {
                    date: '2024-01-16',
                    itemName: 'Dragon Claws',
                    buyPrice: 125000000,
                    sellPrice: 0,
                    quantity: 1,
                    status: 'Active'
                }
            ];
            updateTable();
            updateStats();
        }

        // Update the flips table
        function updateTable() {
            const tableBody = document.getElementById('flipsTableBody');
            const table = document.getElementById('flipsTable');
            const loading = document.getElementById('loading');
            
            tableBody.innerHTML = '';
            
            if (flipsData.length === 0) {
                loading.textContent = 'No flips recorded yet. Add your first flip!';
                loading.style.display = 'block';
                table.style.display = 'none';
                return;
            }
            
            loading.style.display = 'none';
            table.style.display = 'table';
            
            flipsData.forEach(function(flip, index) {
                const row = document.createElement('tr');
                const totalInvested = flip.buyPrice * flip.quantity;
                const totalReturn = flip.sellPrice * flip.quantity;
                const profit = totalReturn - totalInvested;
                const roi = totalInvested > 0 ? ((profit / totalInvested) * 100).toFixed(1) : 0;
                
                row.innerHTML = 
                    '<td>' + flip.date + '</td>' +
                    '<td>' + flip.itemName + '</td>' +
                    '<td>' + formatGP(flip.buyPrice) + '</td>' +
                    '<td>' + formatGP(flip.sellPrice) + '</td>' +
                    '<td>' + flip.quantity.toLocaleString() + '</td>' +
                    '<td>' + formatGP(totalInvested) + '</td>' +
                    '<td class="' + (profit >= 0 ? 'profit-positive' : 'profit-negative') + '">' + formatGP(profit) + '</td>' +
                    '<td class="' + (roi >= 0 ? 'profit-positive' : 'profit-negative') + '">' + roi + '%</td>' +
                    '<td>' + flip.status + '</td>' +
                    '<td><button onclick="editFlip(' + index + ')" class="btn" style="padding: 5px 10px; margin: 2px;">Edit</button></td>';
                
                tableBody.appendChild(row);
            });
        }

        // Update statistics
        function updateStats() {
            const completedFlips = flipsData.filter(function(flip) { return flip.status === 'Completed'; });
            const activeFlips = flipsData.filter(function(flip) { return flip.status === 'Active'; });
            
            let totalProfit = 0;
            completedFlips.forEach(function(flip) {
                const profit = (flip.sellPrice * flip.quantity) - (flip.buyPrice * flip.quantity);
                totalProfit += profit;
            });
            
            const avgProfit = completedFlips.length > 0 ? totalProfit / completedFlips.length : 0;
            
            document.getElementById('totalProfit').textContent = formatGP(totalProfit);
            document.getElementById('activeFlips').textContent = activeFlips.length;
            document.getElementById('completedFlips').textContent = completedFlips.length;
            document.getElementById('avgProfit').textContent = formatGP(Math.round(avgProfit));
        }

        // Format GP values
        function formatGP(value) {
            if (value >= 1000000) {
                return (value / 1000000).toFixed(1) + 'M gp';
            } else if (value >= 1000) {
                return (value / 1000).toFixed(1) + 'K gp';
            } else {
                return value.toLocaleString() + ' gp';
            }
        }

        // Show/hide loading
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.textContent = 'Loading...';
                loading.style.display = 'block';
            }
        }

        // Edit flip
        function editFlip(index) {
            const flip = flipsData[index];
            document.getElementById('itemName').value = flip.itemName;
            document.getElementById('buyPrice').value = flip.buyPrice;
            document.getElementById('sellPrice').value = flip.sellPrice;
            document.getElementById('quantity').value = flip.quantity;
            document.getElementById('status').value = flip.status;
        }

        // Clear all flips
        function clearAllFlips() {
            if (confirm('‚ö†Ô∏è Are you sure you want to delete ALL flips?')) {
                if (typeof google !== 'undefined' && google.script) {
                    google.script.run.clearAllFlips();
                }
                flipsData = [];
                updateTable();
                updateStats();
                alert('‚úÖ All flips cleared!');
            }
        }

        // Export data
        function exportData() {
            alert('üì§ Export functionality - would download CSV file with all flip data');
        }

        // Show profit analysis
        function showProfitAnalysis() {
            const completedFlips = flipsData.filter(function(flip) { return flip.status === 'Completed'; });
            if (completedFlips.length === 0) {
                alert('üìä No completed flips to analyze yet!');
                return;
            }
            alert('üìà Profit Analysis:\n\nTotal Flips: ' + completedFlips.length + '\nWould show detailed charts and insights here.');
        }

        // Load dashboard
        function loadDashboard() {
            // Dashboard content is already in HTML
        }

        // Load history
        function loadHistory() {
            document.getElementById('historyContent').innerHTML = '<p style="text-align: center; color: #f4e4bc;">Complete flip history would be displayed here with advanced filtering options.</p>';
        }

        // Search history
        function searchHistory() {
            const searchTerm = document.getElementById('searchHistory').value;
            alert('üîç Searching for: ' + searchTerm);
        }

        // Export history
        function exportHistory() {
            alert('üì§ Exporting complete history...');
        }

        // Auto-refresh every 5 minutes
        setInterval(refreshData, 300000);
    </script>
</body>
</html>
